# AI集成使用说明

## 概述

智能随机手机号码生成器现已集成OpenRouter AI服务，支持自然语言输入来生成手机号码。用户可以用中文或英文描述需求，AI会自动识别国家和数量信息。

## 功能特性

### 1. 自然语言理解
- 支持中英文输入
- 自动识别国家名称
- 自动提取数量信息
- 智能默认值处理

### 2. 支持的输入示例

**英文示例：**
- "Generate 10 US phone numbers"
- "I need some German phone numbers"
- "Create 20 Chinese mobile numbers"
- "Give me 5 UK numbers"

**中文示例：**
- "生成10个美国手机号"
- "我需要一些德国电话号码"
- "创建20个中国手机号"
- "给我5个英国号码"

### 3. 智能识别规则
- 如果未指定数量，默认生成50个
- 如果未指定国家，返回"unknown"状态
- 支持国家名称的多种表达方式
- 自动更新前端选择器

## 配置说明

### 1. 环境变量配置

在Vercel项目设置中添加以下环境变量：

```bash
OPENROUTER_API_KEY=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
```

### 2. 本地开发配置

创建`.env.local`文件：

```bash
OPENROUTER_API_KEY=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
VERCEL_URL=http://localhost:3000
```

## API端点

### `/api/ai-proxy`

**功能：** 解析用户自然语言输入，提取国家和数量信息

**请求方法：** POST

**请求体：**
```json
{
  "prompt": "用户的自然语言输入"
}
```

**成功响应：**
```json
{
  "success": true,
  "country": "United States",
  "quantity": 10,
  "originalPrompt": "Generate 10 US phone numbers"
}
```

**失败响应：**
```json
{
  "success": false,
  "error": "Could not recognize country or quantity, please try selecting manually.",
  "originalPrompt": "用户输入",
  "aiResponse": "AI原始响应"
}
```

## 使用流程

1. **用户输入：** 在AI输入框中输入自然语言描述
2. **AI解析：** 系统调用`/api/ai-proxy`解析用户输入
3. **参数提取：** 提取国家和数量信息
4. **界面更新：** 自动更新国家选择器和数量输入框
5. **号码生成：** 使用传统算法生成手机号码
6. **结果显示：** 展示生成的手机号码和AI解析结果

## 错误处理

### 1. AI服务不可用
- 显示友好错误提示
- 自动回退到手动选择模式
- 继续使用传统生成算法

### 2. 解析失败
- 显示解析失败提示
- 保持用户当前选择
- 提示用户手动选择参数

### 3. 网络错误
- 显示连接错误提示
- 提供重试建议
- 回退到离线模式

## 性能优化

### 1. 模型选择
- 使用`anthropic/claude-3-haiku`模型
- 平衡速度和准确性
- 控制token使用量

### 2. 请求优化
- 限制最大token数量为200
- 设置低温度值(0.1)确保一致性
- 10秒超时限制

### 3. 缓存策略
- 前端显示即时反馈
- 避免重复请求
- 优雅降级处理

## 安全考虑

### 1. API密钥保护
- 密钥存储在环境变量中
- 不在前端暴露密钥
- 通过Vercel Functions代理请求

### 2. 输入验证
- 验证请求格式
- 限制输入长度
- 防止恶意输入

### 3. 错误信息
- 不暴露内部错误详情
- 提供用户友好的错误提示
- 记录详细日志用于调试

## 测试建议

### 1. 功能测试
- 测试各种语言输入
- 验证国家识别准确性
- 检查数量提取正确性

### 2. 边界测试
- 测试空输入
- 测试超长输入
- 测试无效输入

### 3. 错误测试
- 模拟网络错误
- 测试API密钥错误
- 验证降级机制

## 监控和维护

### 1. 性能监控
- 监控API响应时间
- 跟踪成功率
- 分析用户使用模式

### 2. 成本控制
- 监控API调用次数
- 优化prompt设计
- 实施使用限制

### 3. 持续改进
- 收集用户反馈
- 优化prompt工程
- 扩展支持的国家和语言